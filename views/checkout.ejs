<html ng-app="mainModule" style="overflow-y: hidden;">

<head ng-cloak>
    <%- include('partial/imports')%>
        <%- include('partial/header', {title: title}); %>
            <link href="/resources/css/checkout.css" rel="stylesheet">
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCbxP17w7jZr5QNnLQUmCJ8X3h1kl4EtFs&libraries=places"></script>
</head>

<body ng-cloak>
    <div ng-controller="checkoutController">
        <div layout="row" layout-align="center" class="container">
            <div class="col1">
                <div class="col1ChevRgt">
                    <md-button aria-label="toggleRight" ng-click="toggleRight()" class="open-btn" hide-gt-md>
                        <ng-md-icon icon="keyboard_arrow_left" class="open-btn-icon"></ng-md-icon>
                        <span class="details-text">Details</span>
                    </md-button>
                </div>
                <div class="userPic">
                    <img ng-src="{{'/resources/images/Homit_Logo.jpeg'}}" width="100" height="100" />
                </div>

                <!-- <div id="tempMessage">
            The website is experiencing some technical difficulties, we apologise for any inconvenience and appreciate your understanding. Our team is working to fix the issue. Thank You for your patience!
            </div> -->

                <input id="stripeToken" value="<%= stripeToken %>" hidden>
                <!--DoB-->
                <form name="checkoutInput" ng-submit="submitCheckout(checkoutInput.$valid)">
                    <div id="dob" layout="column" ng-if="userInfo.hasLiquor">
                        <div layout="row" layout-align="center">
                            <md-input-container class="md-block bigClass">
                                <label class="inptLbl">Date</label>
                                <md-select name="date_day" ng-model="userInfo.birth_day" ng-change="updateBDays(); checkUserAge()" required>
                                    <md-option ng-value="-1" ng-disabled="true">Day</md-option>
                                    <md-option ng-value="day" ng-repeat="day in b_days">{{ day }}</md-option>
                                </md-select>
                                <div ng-messages="checkoutInput.date_day.$error">
                                    <div ng-message="required" class="inptErMsg">Required</div>
                                </div>
                            </md-input-container>
                            <md-input-container class="md-block bigClass">
                                <label class="inptLbl">of</label>
                                <md-select name="date_month" ng-model="userInfo.birth_month" ng-change="updateBDays(); checkUserAge()" required>
                                    <md-option ng-value="-1" ng-disabled="true">Month</md-option>
                                    <md-option ng-value="month" ng-repeat="month in b_months">{{ month }}</md-option>
                                </md-select>
                                <div ng-messages="checkoutInput.date_month.$error">
                                    <div ng-message="required" class="inptErMsg">Required</div>
                                </div>
                            </md-input-container>
                            <md-input-container class="md-block bigClass">
                                <label class="inptLbl">Birth</label>
                                <md-select name="date_year" ng-model="userInfo.birth_year" ng-change="updateBDays(); checkUserAge()" required>
                                    <md-option ng-value="-1" ng-disabled="true">Year</md-option>
                                    <md-option ng-value="year" ng-repeat="year in b_years">{{ year }}</md-option>
                                </md-select>
                                <div ng-messages="checkoutInput.date_year.$error">
                                    <div ng-message="required" class="inptErMsg">Required</div>
                                </div>
                            </md-input-container>
                        </div>
                        <div ng-if="userInfo.dob_valid == false" class="bodErrMsg_A">
                            <span class="bodErrMsg_B">Homit liquor in {{ userInfo.dob_diff + ' '}}days</span>
                        </div>
                    </div>
                    <!--First & Last Name-->
                    <div layout="row" layout-align="center" style="margin: 0;">
                        <md-input-container class="md-block bigClass" flex="40">
                            <label class="inptLbl">First Name</label>
                            <input name="fname" maxlength="30" ng-pattern="/^[a-zA-Z]*$/" ng-model="userInfo.first_name" ng-blur="sanitizeInput(userInfo.first_name,'fname')"
                                type="text" required />
                            <div ng-messages="checkoutInput.fname.$error">
                                <div ng-message="pattern" class="inptErMsg">Letters only</div>
                                <div ng-message="required" class="inptErMsg">Required</div>
                            </div>
                        </md-input-container>
                        <md-input-container class="md-block bigClass" flex="40">
                            <label class="inptLbl">Last Name</label>
                            <input name="lname" maxlength="30" ng-pattern="/^[a-zA-Z]*$/" ng-model="userInfo.last_name" ng-blur="sanitizeInput(userInfo.last_name,'lname')"
                                type="text" required/>
                            <div ng-messages="checkoutInput.lname.$error">
                                <div ng-message="pattern" class="inptErMsg">Letters only</div>
                                <div ng-message="required" class="inptErMsg">Required</div>
                            </div>
                        </md-input-container>
                    </div>
                    <!--Email-->
                    <div class="inptFrm">
                        <md-input-container class="md-block bigClass" flex="80">
                            <label class="inptLbl">Email</label>
                            <input name="email" ng-pattern="/^.+@.+\..+$/" ng-disabled="userSignedIn" ng-model="userInfo.user_email" ng-blur="sanitizeInput(userInfo.user_email,'email')"
                                type="email" required/>
                            <div ng-messages="checkoutInput.email.$error">
                                <div ng-message="pattern" class="inptErMsg">Email format only</div>
                                <div ng-message="required" class="inptErMsg">Required</div>
                            </div>
                        </md-input-container>
                    </div>
                    <!--Phone Number-->
                    <div class="inptFrm">
                        <md-input-container class="md-block bigClass" flex="80">
                            <label for="idCell" class="inptLbl">Phone</label>
                            <input id="gP_number" name="phone" minlength="5" maxlength="14" ng-pattern="/^[0-9()+ -]*$/" ng-model="userInfo.phone_number"
                                ng-blur="sanitizeInput(userInfo.phone_number,'phone')" placeholder="(403) 404-6648" type="text"
                                required/>
                            <div ng-messages="checkoutInput.phone.$error">
                                <div ng-message="pattern" class="inptErMsg">Numbers only</div>
                                <div ng-message="minlength" class="inptErMsg">Required</div>
                            </div>
                        </md-input-container>
                    </div>
                    <!--Delivery Address-->
                    <div id="address" class="inptFrm gu_address">
                        <md-input-container class="md-block bigClass" flex="80">
                            <label></label>
                            <address-autocomplete style="width: 300px;" input-class="adrInpt" icon-class="adrInpt_x_A" button-class="adrInpt_x" autocomplete="autocomplete"
                                on-address-selected="gotAddressResults" autocomplete-bounds="bounds"></address-autocomplete>
                            <div ng-messages="checkoutInput.address.$error">
                                <div ng-message="required" class="inptErMsg">Required</div>
                            </div>
                            <div ng-if="userInfo.address_valid == false" class="outPlgn_txt">Sorry, we do not deliver to your location at the moment</div>
                        </md-input-container>
                    </div>
                    <!-- Deliver Instruction -->
                    <div id="driver-instruction" class="gu_address flex-end">
                        <md-input-container class="md-block bigClass" flex="50">
                            <label></label>
                            <input id="driverInstruction" name="drInstruction" maxlength="60" ng-pattern="/^[a-zA-Z0-9 -]*$/" ng-model="userInfo.drInstruction"
                                ng-blur="sanitizeInput(userInfo.drInstruction,'drInstruction')" placeholder="Driver Instruction"
                                type="text" />
                            <div ng-messages="checkoutInput.drInstruction.$error">
                                <div ng-message="pattern" class="inptErMsg">Number and letter only</div>
                                <div ng-message="maxlength" class="inptErMsg">Maximum 60 characters</div>
                            </div>
                            <div class="outPlgn_txt"></div>
                        </md-input-container>
                    </div>
                    <!--Card Info-->
                    <div class="container cardContainer" flex="80">
                        <md-button aria-label="ShowHideCardInfo" class="card-info-btn" ng-click="toggleCardInfo()" layout="row">
                            <div>
                                <img ng-src="{{'/resources/images/non-catalog-image/visa_logo.jpeg'}}" width="25px;" height="15.625px" />
                            </div>
                            <div>
                                <img ng-src="{{'/resources/images/non-catalog-image/mastercard_logo.jpeg'}}" width="25px;" height="15.625px" />
                            </div>
                            <div>
                                <img ng-src="{{'/resources/images/non-catalog-image/american-express_logo.jpeg'}}" width="25px;" height="15.625px" />
                            </div>
                            <ng-md-icon ng-if="!userInfo.cardIsShown" icon="keyboard_arrow_down" class="opnCIsgn" size="25"></ng-md-icon>
                            <ng-md-icon ng-if="userInfo.cardIsShown" icon="keyboard_arrow_up" class="opnCIsgn" size="25"></ng-md-icon>
                        </md-button>
                    </div>
                    <!--Card Info Hidden Box-->
                    <div id="cardInfoBox">
                        <div layout="column" layout-align="none none" class="stripe-card-info">
                            <!-- Stripe Card Info -->
                            <div>
                                <label id="card-label" for="card">Card</label>
                                <div id="card"></div>
                            </div>
                            <div>
                                <div id="card-errors" role="alert"></div>
                            </div>
                        </div>
                        <!-- Card information -->
                        <div layout="row" layout-align="center" class="billing-info">
                            <md-checkbox ng-model="userInfo.billigAddresSame" ng-click="cardHolder()">
                                <span class="billing-info-text">Billing information same as above</span>
                            </md-checkbox>
                        </div>
                        <div ng-show="!userInfo.billigAddresSame" for="checkoutInput">
                            <div layout="row" layout-align="center">
                                <md-input-container class="md-block extInput" flex="50">
                                    <label class="inptLbl">Name On Card</label>
                                    <input name="cardHolderName" id="cardHolderName" ng-pattern="/^[a-zA-Z ]*$/" maxlength="30" ng-model="userInfo.cardHolderName"
                                        ng-blur="sanitizeInput(cardHolderName,'cardHolderName')" type="text" ng-required="!userInfo.billigAddresSame">
                                    <div ng-messages="checkoutInput.cardHolderName.$error">
                                        <div ng-message="pattern" class="inptErMsg">Letters only</div>
                                        <div ng-message="required" class="inptErMsg">Required</div>
                                    </div>
                                </md-input-container>
                            </div>
                            <div layout="row" layout-align="center">
                                <md-input-container class="md-block extInput" flex="30">
                                    <label class="inptLbl">Address</label>
                                    <input name="expiryDate" id="cardHolderAddress" ng-pattern="/^[a-zA-Z0-9 -,.]*$/" maxlength="30" ng-model="userInfo.cardHolderAddress"
                                        ng-blur="sanitizeInput(cardHolderAddress,'cardHolderAddress')" type="text" ng-required="!userInfo.billigAddresSame">
                                    <div ng-messages="checkoutInput.expiryDate.$error">
                                        <div ng-message="pattern" class="inptErMsg">Address Format</div>
                                        <div ng-message="required" class="inptErMsg">Required</div>
                                    </div>
                                </md-input-container>
                                <md-input-container class="md-block extInput" flex="20">
                                    <label class="inptLbl inptLblSC1">Postal Code</label>
                                    <input name="postalCode" id="cardHolderPostalCode" ng-pattern="/^[a-zA-Z0-9 ]*$/" maxlength="7" ng-model="userInfo.cardHolderPostalCode"
                                        ng-blur="sanitizeInput(cardHolderPostalCode,'cardHolderPostalCode')" type="text" ng-required="!userInfo.billigAddresSame">
                                    <div ng-messages="checkoutInput.postalCode.$error">
                                        <div ng-message="pattern" class="inptErMsg">Postal Code Format</div>
                                        <div ng-message="required" class="inptErMsg">Required</div>
                                    </div>
                                </md-input-container>
                            </div>
                        </div>
                    </div>
                    <div class="HomeItBtn">
                        <button type="submit" name="buttonProcess" class="btn btn-success">Home it</button>
                    </div>
                </form>
            </div>
            <!--Order Summary SideNav-->
            <md-sidenav class="md-sidenav-right mdSideNavL1" md-component-id="right" md-is-locked-open="$mdMedia('gt-md')" md-whiteframe="4">
                <md-content layout-padding>
                    <div class="receiptB1">
                        <div class="summerLnP1">
                            <md-button ng-click="close()" aria-label="HideSideNav" hide-gt-md class="sidNav-close-button">
                                <ng-md-icon icon="keyboard_arrow_right"></ng-md-icon>
                            </md-button>
                            <span class="summerLnP2">Order Summary</span>
                        </div>
                        <div layout="row" layout-align="center" class="receiptB1b">
                            <div class="receiptB2">
                                <ul class="receiptB2a">
                                    <li>Cart:</li>
                                    <li>Delivery Fee:</li>
                                    <li>GST:</li>
                                </ul>
                            </div>
                            <div class="receiptB2">
                                <ul class="receiptB2b">
                                    <li>C${{totalAmount}}</li>
                                    <li>C${{delFee}}</li>
                                    <li>C${{GST}}</li>
                                </ul>
                            </div>
                        </div>
                        <div layout="row" layout-align="center">
                            <div class="receiptB3">
                                <ul class="receiptB3a">
                                    <li>Total:</li>
                                </ul>
                            </div>
                            <div class="receiptB3">
                                <ul class="receiptB3b">
                                    <li>C${{receipt}}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div id="product-list">
                        <div ng-repeat="super_category in userCartToView" class="cartBItems1">
                            <div class="store-break">
                                <div flex="10" class="store-break-line"></div>
                                <span class="store-type">{{ super_category[0] }}</span>
                                <div class="store-break-line"></div>
                            </div>
                            <div ng-repeat="product in super_category[1]">
                                <div layout="row" layout-align="center">
                                    <div class="cartBItems2A" flex="30">
                                        <ul>
                                            <li>
                                                <md-button aria-label="plusItem" ng-click="plusItem(product)" class="item-button">
                                                    <ng-md-icon icon="add_circle_outline"></ng-md-icon>
                                                </md-button>
                                            </li>
                                            <li>
                                                <md-button aria-label="minusItem" ng-click="minusItem(product)" class="item-button">
                                                    <ng-md-icon icon="remove_circle_outline"></ng-md-icon>
                                                </md-button>
                                            </li>
                                        </ul>
                                    </div>
                                    <div flex="35" layout="column">
                                        <li class="clear-item-li">
                                            <md-button id="item-remove-button" aria-label="removeFromCart" ng-click="removeFromCart(product)" class="item-button">
                                                <ng-md-icon icon="clear"></ng-md-icon>
                                            </md-button>
                                        </li>
                                        <li>
                                            <img class="cartBItems2B2" ng-src={{product.image}}>
                                        </li>
                                    </div>
                                    <div class="cartBItems2C" flex="35">
                                        <ul class="cartBItems2C2">
                                            <li>{{ product.brand }} {{ product.name }}</li>
                                            <li>{{ product.volume }}</li>
                                            <li>{{ product.quantity + ' '}} X {{product.packaging }}</li>
                                            <li>C${{ product.price }}</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </md-content>
            </md-sidenav>
        </div>
        <!-- Payment Modal -->
        <div id="checkoutModal" class="modal fade" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content">
                    <div class="modal-body" id="modalBody">
                        <div layout="column">
                            <div id="inProcess" ng-if="paymentResult == 'inProcess' ">
                                <div class="inPr_A">
                                    <span class="inPr_AA">Payment in process...</span>
                                </div>
                                <div class="inPr_B">
                                    <md-progress-circular md-colors="{color: 'primary'}" md-diameter="76" ng-disabled="paymentResult != 'inProcess' "></md-progress-circular>
                                </div>
                            </div>
                            <div id="paymentResult" ng-if="paymentResult == '1' || paymentResult == '02' || paymentResult == '0' || paymentResult == '01' || paymentResult == '10' || paymentResult == '11' ">
                                <div class="pR_A">
                                    <md-button class="modal-close-button" ng-click="clearPage()">
                                        <ng-md-icon icon="close" class="modal-close-button-icon"></ng-md-icon>
                                    </md-button>
                                    <md-button ng-click="clearPage()" class="clrPg">
                                        <ng-md-icon ng-if="paymentResult == '1' " icon="done" class="pR_A1"></ng-md-icon>
                                        <ng-md-icon ng-if="paymentResult == '11' " icon="warning" class="pR_A1 pR_A2"></ng-md-icon>
                                    </md-button>
                                    <ng-md-icon ng-if="paymentResult == '10' || paymentResult == '0'" icon="warning" class="pR_A10"></ng-md-icon>
                                    <ng-md-icon ng-if="paymentResult == '01' || paymentResult == '02' " icon="sentiment_dissatisfied" class="pR_A11"></ng-md-icon>
                                </div>
                                <div class="pR_B">
                                    <span class="pR_BA">{{paymentMessage_1}}{{userInfo.first_name}}</span>
                                </div>
                                <div class="pR_C">
                                    <span class="pR_CA" ng-bind-html="paymentMessage_2"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <% if (!production) { %>
            <script src="/resources/directives/addressAutocomplete.js"></script>
            <script src="/resources/services/localStorage.js"></script>
            <script src="/resources/services/cartService.js"></script>
            <script src="/resources/services/mapServices.js"></script>
            <script src="/resources/services/date.js"></script>
            <script src="/resources/controllers/checkout.js"></script>
            <script src="/resources/controllers/checkout.js"></script>
            <% } %>
                <script src="https://js.stripe.com/v3/"></script>
    </div>
</body>

</html>